<!DOCTYPE html>
<html>
<head>
    <title>Layered Cake & Candle</title>
    <style> 
        body {
            background-color: blueviolet;
            color: beige;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh; 
            margin: 0;
        }

        .centered-text {
            text-align: center;
        }

        .cake-wrapper {
            position: relative;
            width: 300px;
            height: 200px;
            margin: 0 auto 20px;
        }

        .cake {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://static.abeka.com/Shared/ABeka/ProductImages/ClipArt/350443/150x150y160fx160fh-w/350443-Yellow-Birthday-Cake_with-pink-frosting,-without-candles-color-png.png') no-repeat center;
            background-size: contain;
            display: block;
        }

        .candle-img {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            max-height: 100px;
        }

        .flame-img {
            position: absolute;
            top: -170px;
            left: 50%;
            transform: translateX(-50%);
            max-height: 200px;
            mix-blend-mode: screen;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="centered-text">
        <div class="cake-wrapper">
            <span class="cake"></span>
            <img class="candle-img" src="https://drive.google.com/thumbnail?id=17EBeHr4F4wveLfC1O4p6aicYNPLtG7cQ&sz=w200" alt="Candle">
            <img id="flame" class="flame-img" src="https://i.gifer.com/9PrD.gif" alt="Flame"> <!-- Example GIF -->
        </div>
        <h1>Happy Birthday!</h1>
        <p>You made another year around the sun :D</p>
        <p>Now blow the darn candle weirdo</p>
    </div>

    <script>

navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const mic = audioContext.createMediaStreamSource(stream);
    const analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;

    const dataArray = new Uint8Array(analyser.fftSize);
    mic.connect(analyser);

    function detectBlow() {
      analyser.getByteTimeDomainData(dataArray);
      const volume = dataArray.reduce((sum, val) => sum + Math.abs(val - 128), 0) / dataArray.length;

      const flame = document.getElementById('flame');

      if (volume > 15) {
        // Blow detected
        flame.style.opacity = 0;
      } else {
        // Optional: slowly bring flame back if user stops blowing
        flame.style.opacity = 1;
      }

      requestAnimationFrame(detectBlow);

      let blownOut = false;

      function detectBlow() {
        analyser.getByteTimeDomainData(dataArray);
        const volume = dataArray.reduce((sum, val) => sum + Math.abs(val - 128), 0) / dataArray.length;

        const flame = document.getElementById('flame');

        if (volume > 15 && !blownOut) {
            flame.style.opacity = 0;
            blownOut = true;
        }

        requestAnimationFrame(detectBlow);
    }
    requestAnimationFrame(detectBlow);

    }

    detectBlow();
  })
  .catch(error => {
    alert('Mic access denied. Please allow microphone to blow out the candle.');
    console.error(error);
  });
</script>


</body>
</html>
